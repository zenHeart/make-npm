
# 3. NPMåŒ…åŸºç¡€



## exports å’Œ module.exports
<!-- 
æŸ¥çœ‹ç¤ºä¾‹ 3.2
 -->
```js
// require çš„å†…éƒ¨å®ç°
Module.prototype.require = function(id) {
  // 1. åˆ›å»ºä¸€ä¸ªæ¨¡å—å¯¹è±¡		
  // return { exports: {},id:'absolute file path',...};
  var filename = path.resolve(parentIdPath,id) // ç”Ÿæˆç»å¯¹è·¯å¾„
  var module =  new Module(filename) 

  // 2. æå–æ–‡ä»¶å†…å®¹
  var fileContent = fs.readSync(id); //è¯»å–æ–‡ä»¶ä¸ºå­—ç¬¦ä¸²

  // 3. ç¼–è¯‘æ–‡ä»¶å†…å®¹ä¸ºå‡½æ•°
  // var compiledWrapper = compileFunction(fileContent,id)	
  var compiledWrapper = function (exports, require, module, __filename, __dirname) { // å®é™…ä¸Šå¯ç­‰æ•ˆä¸ºå¦‚ä¸‹ä»£ç 
	  //ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ ä½ çš„ä»£ç åœ¨è¿™é‡Œ ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡
	  module.exports = {
		  //....
	  };
  }

 // 4. å®šä¹‰ä¸€ç³»åˆ—ä¼ å…¥å‚æ•°	
  var dirname = path.dirname(id);
  var require = makeRequireFunction(this); // require ä¸Šé™„åŠ äº†ä¸€ç³»åˆ—æ–¹æ³•å’Œå‚æ•°è¯¦è§ https://nodejs.org/docs/latest-v11.x/api/modules.html#modules_require_id
  var exports = this.exports;
  var thisValue = exports;
  var module = this;

  //5. æ‰§è¡Œå‡½æ•°
  compiledWrapper.call(thisValue, exports, require, module,
                                filename, dirname);

  //6. è¿”å› module.exports 
  return module.exports;
}
```
<p class="fade-left fragment" style="color:#cb3837">ç¡®ä¿å¯¼å‡ºå†…å®¹ä¿®æ”¹çš„æ˜¯ module.exports å±æ€§</p> 



## åŒ…çš„è°ƒè¯•
<!-- 
å‚çœ‹ç¤ºä¾‹ 3.2 3.3
æ³¨æ„ node ä¸ä¼šåŠ è½½å…¨å±€åŒ…,è¯¦è§ https://nodejs.org/api/modules.html#modules_loading_from_the_global_folders
 -->
* `npm link` è¿æ¥æœ¬åœ°åŒ…åˆ°å…¨å±€å¹¶æµ‹è¯•
* `npm debug <file>` å¯åŠ¨å†…éƒ¨è°ƒè¯•å™¨
* `npm --inspect-brk=[host:port]` é‡‡ç”¨ chrome inspector è°ƒè¯•,æ”¯æŒè¿œç¨‹è°ƒè¯•



## å·¥å…·æ¨è
* [debug](https://www.npmjs.com/package/debug) ç”¨äºå¼€å‘è¿‡ç¨‹ä¸­æ‰“å°è°ƒè¯•ä¿¡æ¯,ä¸è¦ç”¨ console.log
* [nim](https://chrome.google.com/webstore/detail/nodejs-v8-inspector-manag/gnhhdgbaldcilmgcpfddgdbkhjohddkj?utm_source=chrome-ntp-icon) nodejs è°ƒè¯•æ’ä»¶